<!DOCTYPE html>
<html>
  <head>
    <title>Garden</title>
    <link rel="apple-touch-icon" href="bread.png">
    <!-- <meta http-equiv="refresh" content="20"> -->
    <!-- EXTERNAL LIBS-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://www.google.com/jsapi"></script>

    <!-- EXAMPLE SCRIPT -->
    <script>

      function getData(maxPages) {
        all_data = [];
        var public_key = 'OG6Wn5ANN5HMXryVqjRm';
        for(var page =1; page < maxPages; page++ ) {
          var jsonData = JSON.parse($.ajax({
            url: 'https://data.sparkfun.com/output/' + public_key + '.json',
            data: {page: page},
            dataType: 'json',
            async: false,
          }).responseText);

          $.each(jsonData, function (i, row) {
              all_data.push(row);
          });
        }
        return all_data;
      }


      // onload callback
      function drawCharts() {
        all_data = getData(10);

        var soiltemp_voltage_data = new google.visualization.DataTable();
        soiltemp_voltage_data.addColumn('datetime', 'timestamp');
        soiltemp_voltage_data.addColumn('number', 'soiltempf');
        soiltemp_voltage_data.addColumn('number', 'tempf');
        soiltemp_voltage_data.addColumn('number', 'solarvoltage');
        $.each(all_data, function (i, row) {
          soiltemp_voltage_data.addRow([
            (new Date(row.timestamp)),
            parseFloat(row.soiltempf),
            parseFloat(row.tempf),
            parseFloat(row.solarvoltage)
            ]);
        });

        var soiltemp_voltage_chart = new google.visualization.LineChart($('#soiltemp_voltage_chart').get(0));

        soiltemp_voltage_chart.draw(soiltemp_voltage_data, {
          title: 'Sun and temperature',
          series: {
            0: {targetAxisIndex: 0},
            1: {targetAxisIndex: 0},
            2: {targetAxisIndex: 1}
          },
          vAxes: {
            0: {title: "temp (f)", viewWindow:{max:20, min:100}},
            1: {title: "solarvoltage", viewWindow:{max:0, min:3000}}
          }
        });




        var rain_soilmoisture = new google.visualization.DataTable();
        rain_soilmoisture.addColumn('datetime', 'timestamp');
        rain_soilmoisture.addColumn('number', 'soilmoisture0');
        rain_soilmoisture.addColumn('number', 'soilmoisture1');
        rain_soilmoisture.addColumn('number', 'rainin');
        $.each(all_data, function (i, row) {
          rain_soilmoisture.addRow([
            (new Date(row.timestamp)),
            parseFloat(row.soilmoisture0),
            parseFloat(row.soilmoisture1),
            parseFloat(row.rainin)
            ]);
        });

        var rain_soilmoisture_chart = new google.visualization.LineChart($('#soilmoisture_chart').get(0));

        rain_soilmoisture_chart.draw(rain_soilmoisture, {
          title: 'Rain and soil moisture',
          series: {
            0: {targetAxisIndex: 0},
            1: {targetAxisIndex: 0},
            2: {targetAxisIndex: 1}
          },
          vAxes: {
            0: {title: "moisture", viewWindow:{max:4096, min:2000}},
            1: {title: "inches", viewWindow:{max:5, min:0}}
          }
        });



        var winds = new google.visualization.DataTable();
        winds.addColumn('datetime', 'timestamp');
        winds.addColumn('number', 'windspeed_avg');
        winds.addColumn('number', 'windgust_avg');
        $.each(all_data, function (i, row) {
          winds.addRow([
            (new Date(row.timestamp)),
            parseFloat(row.windspeed_avg),
            parseFloat(row.windgust_avg),
            ]);
        });

        var winds_chart = new google.visualization.LineChart($('#winds_chart').get(0));

        winds_chart.draw(winds, {
          title: 'Winds',
          series: {
            0: {targetAxisIndex: 0},
            1: {targetAxisIndex: 1},
          },
          vAxes: {
            0: {title: "mph", viewWindow:{max:15, min:0}},
            1: {title: "gust mph", viewWindow:{max:50, min:0}},

          }

        });


        var humidity_and_hg = new google.visualization.DataTable();
        humidity_and_hg.addColumn('datetime', 'timestamp');
        humidity_and_hg.addColumn('number', 'humidity');
        humidity_and_hg.addColumn('number', 'hg');
        $.each(all_data, function (i, row) {
          humidity_and_hg.addRow([
            (new Date(row.timestamp)),
            parseFloat(row.humidity),
            parseFloat(row.hg),
            ]);
        });

        var humidity_and_hg_chart = new google.visualization.LineChart($('#humidity_and_hg_chart').get(0));

        humidity_and_hg_chart.draw(humidity_and_hg, {
          title: 'Humidity and pressure',
          series: {
            0: {targetAxisIndex: 0},
            1: {targetAxisIndex: 1},
          },
          vAxes: {
            0: {title: "percent", viewWindow:{max:100, min:0}},
            1: {title: "hg", viewWindow:{max:31, min:29}},
          }
        });


      }

      // load chart lib
      google.load('visualization', '1', {
        packages: ['corechart']
      });

      // call drawChart once google charts is loaded
      google.setOnLoadCallback(drawCharts);

    </script>

  </head>
  <body>
    <div id="soiltemp_voltage_chart" style="width: 100%; height: 500px;"></div>
    <div id="soilmoisture_chart" style="width: 100%; height: 500px;"></div>
    <div id="winds_chart" style="width: 100%; height: 500px;"></div>
    <div id="humidity_and_hg_chart" style="width: 100%; height: 500px;"></div>

  </body>
</html>
